{% extends "default.html" %}
{% block title %}Add a new message{% end %}
{% block content %}

  <div id="layout">

    <div id="main">
<div class="content">
    <a class="pure-button" href="/messages?{% if item is not None %}&amp;item={{ item }}{% end %}{% if origin %}&amp;origin={{ url_escape(origin) }}{% end %}{% if host is not None %}&amp;host={{ host }}{% end %}">Messages list</a>
  {% if item is not None %}
    <a class="pure-button" href="/item/{{ item }}?{% if origin %}&amp;origin={{ url_escape(origin) }}{% end %}{% if host is not None %}&amp;host={{ host }}{% end %}">Back to Request</a>
  {% end %}
  <h1 class="content-subhead">Add Rule</h1>
  <form class="pure-form" method="post">

    <h2>Message</h2>

    <div class="pure-form-aligned">
    
    <div class="pure-control-group">
    <label for="name">Name</label>
    <input type="text" name="name" size="35" {% if name %}value="{{ name }}"{% end %} placeholder="Message 1" />
    </div>

    <div class="pure-control-group">
    <label for="host">Host</label>
    <input type="text" name="host" size="35" {% if host %}value="{{ host }}"{% elif entry %}value="{{ entry['request']['host'] }}"{% end %} placeholder="google.com" />
    </div>

    <textarea id="message" rows="10" style="width:100%" data-editor="json" name="body" placeholder="body content">{% if body %}{{ body }}{% end %}</textarea>
      <div id="rules-group">
      {% set x = 0 %}
      {% for ruleid, enabled in rules.iteritems() %}
        <div class="pure-control-group">
            <input type="text" value="{{ ruleid }}" name="rules_ids[{{ x }}]" />
            <input type="checkbox" name="rules_states[{{ x }}]" {% if enabled %}checked="checked"{% end %} />
            <button name="delete">X</button>
        </div>
        {% set x = x + 1 %}

      {% end %}

      <div class="pure-control-group">
            <input type="text" name="rules_ids[{{ x }}]" />
            <input type="checkbox" name="rules_states[{{ x }}]" />
        {% if x != 0 %}<button name="delete">X</button>{% end %}
      </div>

    </div>

      <div class="hidden pure-control-group" id="rules-template">
        <input type="text" value="" name="rules_ids[]" />
        <input type="checkbox" name="rules_states[]" />
        <button name="delete">X</button>
      </div>

    <button type="submit" class="pure-button pure-button-primary">Save</button>
  </form>
  {% if tryagain %}
    Try again
  {% end %}

</div>
</div>
</div>

<script src="/static/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ext-modelist.js" type="text/javascript"></script>
<script src="/static/jquery-ui.js"></script>
<script src="/static/editor.js"></script>
<script src="/static/rules.js"></script>
{% end %}
