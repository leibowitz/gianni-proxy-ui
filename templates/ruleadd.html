<!doctype html>
<html lang="en">
  <head>
    <title>MockProxy</title>
<link rel="stylesheet" href="/static/pure-min.css">
<link rel="stylesheet" href="/static/grids-responsive-min.css">
<link rel="stylesheet" href="/static/pure-main-grids-baby-blue-1.15.3.css">
<link rel="stylesheet" href="/static/jquery-ui.min.css">
<link href="/static/main.css" media="all" rel="stylesheet" type="text/css" />

  </head>
  <body>

  <div id="layout">

    <div id="main">
<div class="content">
    <a class="pure-button" href="/rules?{% if item is not None %}&amp;item={{ item }}{% end %}{% if origin %}&amp;origin={{ url_escape(origin) }}{% end %}{% if host is not None %}&amp;host={{ host }}{% end %}">Rules list</a>
  {% if item is not None %}
    <a class="pure-button" href="/item/{{ item }}?{% if origin %}&amp;origin={{ url_escape(origin) }}{% end %}{% if host is not None %}&amp;host={{ host }}{% end %}">Back to Request</a>
  {% end %}
  <h1 class="content-subhead">Add Rule</h1>
  <form class="pure-form" method="post">
    {% if host is not None %}
    <input type="hidden" name="host" value="{{ host }}" />
    {% end %}
    {% if item is not None %}
    <input type="hidden" name="item" value="{{ item }}" />
    {% end %}

    <h2>Request</h2>

    <div class="pure-form-aligned">

    <div class="pure-control-group">
    <label for="origin">Origin</label>
    <input type="text" name="origin" size="35" placeholder="IP of client" value="{% if origin %}{{ origin }}{% end %}" />
    </div>

    <div class="pure-control-group">
    <label for="host">Host</label>
    <input type="text" name="rhost" size="35" {% if host %}value="{{ host }}"{% elif entry %}value="{{ entry['request']['host'] }}"{% end %} placeholder="google.com" />
    </div>

    <div class="pure-control-group">
    <label for="path">Path</label>
    <input type="text" name="path" size="35" placeholder="/path/to" {% if entry %}value="{{ entry['request']['path'] }}"{% end %} />
    </div>

    <div class="pure-control-group">
    <label for="query">Query</label>
    <input type="text" name="query" size="35" placeholder="query=1" {% if entry %}value="{{ entry['request']['query'] }}"{% end %} />
    </div>

    <div class="pure-control-group">
    <label for="method">Method</label>
    <input type="text" name="method" size="10" placeholder="GET" {% if entry %}value="{{ entry['request']['method'] }}"{% end %} />
    </div>

    </div>
    <h3>Headers</h3>
      <div id="reqheaders">
      {% set x = 0 %}
      {% for name, value in reqheaders.iteritems() %}
        <div class="pure-control-group">
          <input type="text" name="reqheader[{{ x }}][]" value="{{ name }}" />
          <input type="text" name="reqheader[{{ x }}][]" value="{{ value }}" />
          <button name="delete">X</button>
        </div>
        {% set x = x + 1 %}

      {% end %}

      <div class="pure-control-group" id="reqheaders-template">
        <input type="text" name="reqheader[{{ x }}][]" value="" />
        <input type="text" name="reqheader[{{ x }}][]" value="" />
        <button name="delete">X</button>
      </div>

      </div>

    <h2>Response</h2>

    <input type="hidden" name="response" value="{% if item %}{{ item }}{% end %}" />

    <div class="pure-form-aligned">

      <div class="pure-control-group">
        <label for="status">Status</label>
        <input type="text" name="status" size="10" placeholder="200" {% if entry %}value="{{ entry['response']['status'] }}"{% end %} />
      </div>
    
      <div class="pure-control-group">
        <label for="delay">Delay</label>
        <input type="text" name="delay" size="10" placeholder="seconds" value="" /> in seconds
      </div>

    </div>

    <h3>Body</h3>
    <textarea rows="10" style="width:100%" data-editor="{% if fmt %}{{ fmt }}{% end %}" name="body" placeholder="body content">{% if body %}{{ body }}{% end %}</textarea>

    <h3>Headers</h3>
      <div id="respheaders">
      {% set x = 0 %}
      {% for name, value in respheaders.iteritems() %}
        <div class="pure-control-group">
          <input type="text" name="respheader[{{ x }}][]" value="{{ name }}" />
          <input type="text" name="respheader[{{ x }}][]" value="{{ value }}" />
          <button name="delete">X</button>
        </div>
        {% set x = x + 1 %}

      {% end %}

      <div class="pure-control-group" id="respheaders-template">
        <input type="text" name="respheader[{{ x }}][]" value="" />
        <input type="text" name="respheader[{{ x }}][]" value="" />
        <button name="delete">X</button>
      </div>

      </div>

    <button type="submit" class="pure-button pure-button-primary">Save</button>
  </form>
  {% if tryagain %}
    Try again
  {% end %}

</div>
</div>
</div>

<script src="/static/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ext-modelist.js" type="text/javascript"></script>
<script src="/static/jquery-ui.js"></script>
<script src="/static/editor.js"></script>
<script type="text/javascript">
  (function(){
   /*
    * Handling the removal of a headers line
    */
   $(document).on('click', 'button[name=delete]', function(evt){
      evt.preventDefault();
      // Need to swap the names of this line with the last line
      var allButtons = $('button[name=delete]');
      $(this).parent().remove();
    });
   /*
    * Adding headers line when we edit the last line
    */
   var tmplElements = $('#reqheaders-template').clone().removeAttr('id');
   $(document).on('change paste keyup', 'input[type=text][name^="reqheader"]', function(evt){
     var elements = $('input[type=text][name^="reqheader"]');
     var last = elements.last().get(0);
     var lineElements = $('input[type=text][name="'+$(this).attr('name')+'"]');
     var isLast = lineElements.filter(function(index, current){
      //console.log(current);
        return current == last;
       }).length != 0;
     // if we edited the last header line, add a new one
     if (isLast) {
      var newElements = tmplElements.clone();
      newElements.appendTo("#reqheaders");
      newElements.find('input').attr('name', 'reqheader['+(elements.length/2)+'][]');
     }
    });
  })();
</script>

</body>
</html>
