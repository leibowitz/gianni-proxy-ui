<html>
  <head>
    <title>Gianni's Proxy</title>
<style type="text/css">
  .hidden {
    display: none;
  }
</style>
<script src="/static/sockjs-0.3.min.js"></script>
<script src="/static/jquery.min.js"></script>

  </head>
  <body>
{% from pygments import highlight %}
{% from pygments.lexers import JsonLexer %}
{% from pygments.formatters import HtmlFormatter %}

One
<div>
{{ item['_id'] }}
</div>
<div>
{{ item['request']['method'] }}
{{ item['response']['status'] }}
<a href="{{ item['request']['host'] }}">{{ item['request']['host'] }}</a>
</div>
<h2>Request</h2>
<table>
{% for key, value in requestheaders.iteritems() %}
  <tr>
    <td>
  {{ key }}: {{ value }}
    </td>
  </tr>
{% end %}
</table>
{% if item['request']['body'] %}
<div>
<pre lang="json">{{ item['request']['body'] }}</pre>
</div>
{% end %}
<h2>Response</h2>
<table>
{% for key, value in responseheaders.iteritems() %}
  <tr>
    <td>
  {{ key }}: {{ value }}
    </td>
  </tr>
{% end %}
</table>
{% if item['response']['body'] %}
<div>
<pre lang="json">{{ item['response']['body'] }}</pre>
</div>
{% end %}
{% if 'content-type' in responseheaders and 'text' in responseheaders['content-type'] %}
{% end %}
<script type="text/javascript">
var sock;
function createSocket()
{
  sock = new SockJS('/body');
  sock.onopen = function() {
      console.log('open');
      sock.send('{{ item['response']['fileid'] }}')
  };
  sock.onmessage = function(e) {
    console.log(e.data);
  };
  sock.onclose = function() {
      console.log('close');
      sock = null;
  };
}
createSocket();
</script>
</body>
</html>
