{% extends "default.html" %}
{% block title %}List of host rewrites{% end %}
{% block content %}
        <div class="box">
  <div class="layout">

    <a class="pure-button" href="/rewrites/add?{% if item is not None %}&amp;item={{ item }}{% end %}{% if origin %}&amp;origin={{ url_escape(origin) }}{% end %}{% if host is not None %}&amp;host={{ host }}{% end %}">Add Rewrite</a>

{% if len(items) != 0 %}
<table>
  <thead>
    <th>
      Active
    </th>
    <th>
      Host Rewrite
    </th>
    {% if not origin %}
    <th>
      Origin
    </th>
    {% end %}
    <th>
    </th>
  </thead>
  <tbody>
{% for row in items %}
  <tr>
    <td>
      <form name="activateForm" method="post">
        <input type="hidden" name="ident" value="{{ row['_id'] }}" />
        <input type="hidden" name="action" value="{% if row['active'] %}disable{% else %}enable{% end %}" />
        <input type="checkbox" class="uiswitch" {% if row['active'] %}checked="checked"{% end %} />
      </form>
    </td>
    <td>
      <a href="/rewrite/{{ row['_id'] }}?{% if origin %}&amp;origin={{ url_escape(origin) }}{% end %}{% if host is not None %}&amp;host={{ host }}{% end %}{% if item is not None %}&amp;item={{ item }}{% end %}">
      {% if row['protocol'] %}{{ row['protocol'] }}://{% end %}{% if row['host'] %}{{ row['host'] }}{% end %}
      <br />
      => {% if row['dprotocol'] %}{{ row['dprotocol'] }}://{% end %}{% if row['dhost'] %}{{ row['dhost'] }}{% elif row['host'] %}{{ row['host'] }}{% end %}
      </a>
    </td>
    {% if not origin %}
    <td>
        {% if 'origin' in row and row['origin'] %}<a href="/rewrites?origin={{ row['origin'] }}">{{ row['origin'] }}</a>{% end %}
    </td>
    {% end %}
    <td>
      <form method="post" name="deleteForm">
        <input type="hidden" name="ident" value="{{ row['_id'] }}" />
        <input type="hidden" name="action" value="delete" />
            <button class="btn" name="delete"><i class="fa fa-times"></i></button>
      </form>
    </td>
  </tr>
{% end %}
  </tbody>
</table>
{% end %}

</div>
        </div>

<script src="/static/jquery.min.js"></script>
<script type="text/javascript">
    $('form[name=deleteForm] button[name=delete]').on('click', function(evt){
      var t = evt.currentTarget;
      evt.preventDefault();
      if (confirm("Are you sure you want to delete this rule?")) {
        var id = t.parentNode.querySelector('input[name=ident]').value;
        $.post("/rewrites", {ident: id, action: "delete"}, function(data, status) {
          var row = t.parentNode.parentNode.parentNode;
          row.parentNode.removeChild(row);
        });
      }
    });
    $('form[name=activateForm] input[type=checkbox]').on('click', function(evt){
      var id = evt.target.parentNode.querySelector('input[name=ident]').value;
      var action = evt.target.checked ? "enable" : "disable";
      $.post("/rewrites", {ident: id, action: action});
      
    });
</script>
{% end %}
